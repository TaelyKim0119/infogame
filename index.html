<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì‚¬ë‹¤ë¦¬ ê²Œì„ - ë°©í–¥ ìˆ˜ì • ë²„ì „</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #E3F2FD;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    
    .container {
      max-width: 800px;
      width: 100%;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #1976D2 0%, #0D47A1 100%);
      color: white;
      padding: 20px;
      text-align: center;
    }
    
    .game-area {
      padding: 20px;
      background-color: #E3F2FD;
    }
    
    .footer {
      padding: 15px;
      background-color: #f5f5f5;
      text-align: center;
      color: #666;
    }
    
    .inventory-status {
      text-align: center;
      margin-top: 20px;
      padding: 10px;
      background-color: #FFF9C4;
      border-radius: 5px;
      color: #F57F17;
      font-size: 14px;
      font-weight: bold;
    }
    
    button {
      background: linear-gradient(to right, #1976D2, #0D47A1);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      margin: 10px auto;
      display: block;
      font-weight: bold;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .players, .results {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
    }
    
    .player, .result {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s;
      color: white;
      text-align: center;
    }
    
    .player {
      background-color: #1565C0;
    }
    
    .player:hover {
      transform: scale(1.1);
    }
    
    .player.selected {
      background-color: #00B0FF;
    }
    
    .result {
      background-color: #4CAF50;
    }
    
    .canvas-container {
      position: relative;
      height: 300px;
      margin: 20px 0;
      background-color: #0D47A1;
      border-radius: 10px;
      overflow: hidden;
    }
    
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .debug-info {
      background-color: #FFECB3;
      padding: 10px;
      border-radius: 5px;
      margin-top: 20px;
      font-size: 14px;
      display: none;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .popup {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      display: none;
    }
    
    .popup-content {
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    
    .emoji {
      font-size: 24px;
      margin-top: 5px;
    }
    
    .result-emoji {
      font-size: 50px;
      margin: 20px 0;
    }
    
    .inventory {
      background-color: #0D47A1;
      color: white;
      padding: 10px;
      border-radius: 10px;
      margin: 15px 0;
      text-align: center;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ì •ë³´ë³´ì•ˆì•”í˜¸ìˆ˜í•™ê³¼ ì‚¬ë‹¤ë¦¬ ê²Œì„</h1>
      <p>ì „ê³µíƒìƒ‰ë°•ëŒíšŒ íŠ¹ë³„ ì´ë²¤íŠ¸</p>
    </div>
    
    <div class="game-area">
      <div class="players">
        <div class="player" data-index="0">
          <span class="emoji">ğŸ’»</span>
          <span>ì •ë³´</span>
        </div>
        <div class="player" data-index="1">
          <span class="emoji">ğŸ”’</span>
          <span>ë³´ì•ˆ</span>
        </div>
        <div class="player" data-index="2">
          <span class="emoji">ğŸ”</span>
          <span>ì•”í˜¸</span>
        </div>
        <div class="player" data-index="3">
          <span class="emoji">ğŸ“Š</span>
          <span>ìˆ˜í•™</span>
        </div>
        <div class="player" data-index="4">
          <span class="emoji">ğŸŒ</span>
          <span>ì‚¬ì´ë²„</span>
        </div>
      </div>
      
      <div class="inventory">
        <p>ë‚¨ì€ ìƒí’ˆ:  ì•„ì´ìŠ¤ì»¤í”¼ ì¿ í° <span id="coffee-count">100</span>/100  |  í”Œë ˆì´ìŠ¤ì•¤ ì¿ í° <span id="placean-count">20</span>/20  |  êµìˆ˜ì™€ì˜ ì‹ì‚¬ <span id="professor-count">3</span>/3  |  ë©˜í† ì™€ì˜ ì‹ì‚¬ <span id="mentor-count">3</span>/3</p>
      </div>
      
      <div class="canvas-container">
        <canvas id="ladder-canvas"></canvas>
      </div>
      
      <div class="results">
        <div class="result" id="result0">
          <span class="emoji">ğŸ†</span>
          <span>ìƒí’ˆ1</span>
        </div>
        <div class="result" id="result1">
          <span class="emoji">ğŸ</span>
          <span>ìƒí’ˆ2</span>
        </div>
        <div class="result" id="result2">
          <span class="emoji">ğŸ’°</span>
          <span>ìƒí’ˆ3</span>
        </div>
        <div class="result" id="result3">
          <span class="emoji">ğŸ–ï¸</span>
          <span>ìƒí’ˆ4</span>
        </div>
        <div class="result" id="result4">
          <span class="emoji">ğŸ¥‡</span>
          <span>ìƒí’ˆ5</span>
        </div>
      </div>
      
      <button id="reset-button">ì‚¬ë‹¤ë¦¬ ì¬ìƒì„±</button>
      <button id="debug-button">ë””ë²„ê·¸ ëª¨ë“œ í† ê¸€</button>
      
      <div class="debug-info" id="debug-info">
        ë””ë²„ê·¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
      </div>
    </div>
    
    <div class="footer">
      <p>Â© 2025 ì‚¬ë‹¤ë¦¬ ê²Œì„</p>
    </div>
  </div>
  
  <div class="popup" id="result-popup">
    <div class="popup-content">
      <h2 style="color: #1976D2;">ë‹¹ì²¨ ê²°ê³¼!</h2>
      <p><span id="selected-player" style="font-weight: bold; color: #1976D2;"></span> í‚¤ì›Œë“œì—ì„œ ì‹œì‘í•˜ì—¬</p>
      
      <div style="background-color: #E3F2FD; padding: 20px; border-radius: 10px; margin: 20px 0;">
        <div id="result-emoji" class="result-emoji"></div>
        <div id="result-name" style="font-size: 24px; font-weight: bold; color: #0D47A1;"></div>
      </div>
      
      <p>ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤!</p>
      
      <div style="background-color: #FFF9C4; padding: 10px; border-radius: 5px; border: 1px solid #FFECB3; margin: 15px 0; display: none;" id="sold-out-notice">
        <p style="color: #F57F17; margin: 0;">â€» ëª¨ë“  ìƒí’ˆì´ ì†Œì§„ë˜ë©´ ìë™ìœ¼ë¡œ ê½ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.</p>
      </div>
      
      <button id="close-popup">ë‹«ê¸°</button>
    </div>
  </div>
  
  <script>
    // ê²Œì„ ì„¤ì •
    const NUM_PLAYERS = 5;
    const LADDER_HEIGHT = 300;
    const ANIMATION_DURATION = 9000; // ì „ì²´ ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ (ms) - ì´ì „ë³´ë‹¤ 2ë°° ë” ëŠë¦¬ê²Œ ì„¤ì •
    
    // ê²Œì„ ìƒíƒœ
    let isAnimating = false;
    let selectedPlayer = null;
    let verticalLines = [];
    let horizontalLines = [];
    let resultOrder = [0, 1, 2, 3, 4];
    let debugMode = false;
    
    // ìƒí’ˆ ì •ë³´
    const prizes = [
      { name: 'ì•„ì´ìŠ¤ì»¤í”¼ ì¿ í°', emoji: 'â˜•', total: 100, remaining: 100 },
      { name: 'í”Œë ˆì´ìŠ¤ì•¤ ì¿ í°', emoji: 'ğŸŸï¸', total: 20, remaining: 20 },
      { name: 'ì „ê³µíƒìƒ‰ êµìˆ˜ì™€ì˜ ì‹ì‚¬', emoji: 'ğŸ½ï¸', total: 3, remaining: 3 },
      { name: 'ë©˜í† ì™€ì˜ ì‹ì‚¬', emoji: 'ğŸ¥‚', total: 3, remaining: 3 },
      { name: 'ê½', emoji: 'ğŸ˜¢', total: Infinity, remaining: Infinity }
    ];
    
    // DOM ìš”ì†Œ
    const canvas = document.getElementById('ladder-canvas');
    const ctx = canvas.getContext('2d');
    const players = document.querySelectorAll('.player');
    const resetButton = document.getElementById('reset-button');
    const debugButton = document.getElementById('debug-button');
    const debugInfo = document.getElementById('debug-info');
    const resultPopup = document.getElementById('result-popup');
    const closePopupButton = document.getElementById('close-popup');
    const selectedPlayerText = document.getElementById('selected-player');
    const resultEmoji = document.getElementById('result-emoji');
    const resultName = document.getElementById('result-name');
    
    // ì´ˆê¸°í™”
    window.addEventListener('load', () => {
      resizeCanvas();
      generateLadder();
      
      // í”Œë ˆì´ì–´ í´ë¦­ ì´ë²¤íŠ¸
      players.forEach(player => {
        player.addEventListener('click', () => {
          if (isAnimating) return;
          
          const index = parseInt(player.dataset.index);
          clearCanvas();
          drawLadder();
          findPath(index);
        });
      });
      
      // ì‚¬ë‹¤ë¦¬ ì¬ìƒì„± ë²„íŠ¼
      resetButton.addEventListener('click', () => {
        generateLadder();
        clearCanvas();
        drawLadder();
      });
      
      // ë””ë²„ê·¸ ë²„íŠ¼
      debugButton.addEventListener('click', () => {
        debugMode = !debugMode;
        debugInfo.style.display = debugMode ? 'block' : 'none';
        updateDebugInfo("ë””ë²„ê·¸ ëª¨ë“œ: " + (debugMode ? "ì¼œì§" : "êº¼ì§"));
      });
      
      // íŒì—… ë‹«ê¸° ë²„íŠ¼
      closePopupButton.addEventListener('click', () => {
        resultPopup.style.display = 'none';
        
        // ëª¨ë“  ìƒí’ˆì´ ì†Œì§„ë˜ì—ˆëŠ”ì§€ í™•ì¸
        checkAllSoldOut();
        
        // ì¬ê³  ì •ë³´ ì—…ë°ì´íŠ¸
        updateInventoryStatus();
      });
      
      // ì°½ í¬ê¸° ë³€ê²½ ì´ë²¤íŠ¸
      window.addEventListener('resize', () => {
        resizeCanvas();
        clearCanvas();
        drawLadder();
      });
      
      // ì´ˆê¸° ì¸ë²¤í† ë¦¬ í‘œì‹œ
      updateInventoryDisplay();
      updateInventoryStatus();
    });
    
    // ì¸ë²¤í† ë¦¬ ìƒíƒœ ì—…ë°ì´íŠ¸ (í•˜ë‹¨ í‘œì‹œ)
    function updateInventoryStatus() {
      const statusElement = document.querySelector('.inventory-status');
      let statusText = '';
      
      if (prizes[0].remaining > 0) {
        statusText += `ì•„ì´ìŠ¤ì»¤í”¼ ì¿ í°: ${prizes[0].remaining}ì¥  |  `;
      }
      
      if (prizes[1].remaining > 0) {
        statusText += `í”Œë ˆì´ìŠ¤ì•¤ ì¿ í°: ${prizes[1].remaining}ì¥  |  `;
      }
      
      if (prizes[2].remaining > 0) {
        statusText += `êµìˆ˜ì™€ì˜ ì‹ì‚¬: ${prizes[2].remaining}ì¥  |  `;
      }
      
      if (prizes[3].remaining > 0) {
        statusText += `ë©˜í† ì™€ì˜ ì‹ì‚¬: ${prizes[3].remaining}ì¥`;
      }
      
      // ë§ˆì§€ë§‰ êµ¬ë¶„ì ì œê±°
      if (statusText.endsWith('|  ')) {
        statusText = statusText.slice(0, -3);
      }
      
      // ìƒí’ˆì´ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ ë©”ì‹œì§€ ë³€ê²½
      if (statusText === '') {
        statusText = 'ëª¨ë“  ìƒí’ˆì´ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤!';
      }
      
      statusElement.textContent = statusText;
    }
    
    // ëª¨ë“  ìƒí’ˆì´ ì†Œì§„ë˜ì—ˆëŠ”ì§€ í™•ì¸
    function checkAllSoldOut() {
      const allSoldOut = prizes.slice(0, 4).every(prize => prize.remaining === 0);
      
      if (allSoldOut) {
        document.getElementById('sold-out-notice').style.display = 'block';
        updateDebugInfo("ëª¨ë“  ìƒí’ˆì´ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ëª¨ë“  ê²°ê³¼ëŠ” ê½ì…ë‹ˆë‹¤.");
      } else {
        document.getElementById('sold-out-notice').style.display = 'none';
      }
      
      return allSoldOut;
    }
    
    // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
    function resizeCanvas() {
      const container = canvas.parentElement;
      canvas.width = container.clientWidth;
      canvas.height = container.clientHeight;
    }
    
    // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
    
    // ì‚¬ë‹¤ë¦¬ ìƒì„±
    function generateLadder() {
      verticalLines = [];
      horizontalLines = [];
      isAnimating = false;
      selectedPlayer = null;
      
      // ê° í”Œë ˆì´ì–´ì˜ ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
      players.forEach(player => {
        player.classList.remove('selected');
      });
      
      // ì„¸ë¡œì„  ìœ„ì¹˜ ê³„ì‚°
      for (let i = 0; i < NUM_PLAYERS; i++) {
        const x = (canvas.width / NUM_PLAYERS) * i + (canvas.width / NUM_PLAYERS / 2);
        verticalLines.push(x);
      }
      
      // ê°€ë¡œì„  ìƒì„± (ëœë¤)
      horizontalLines = [];
      const minGap = 20; // ìµœì†Œ ê°„ê²©
      const numLines = Math.floor(Math.random() * 10) + 10; // 10-20ê°œì˜ ê°€ë¡œì„ 
      
      for (let i = 0; i < numLines; i++) {
        // ëœë¤í•œ y ìœ„ì¹˜ (ê°„ê²© ìœ ì§€)
        const y = minGap + i * ((canvas.height - 2 * minGap) / numLines) + Math.random() * 10 - 5;
        
        // ëœë¤í•œ ì„¸ë¡œì„  ì¸ë±ìŠ¤ (ë§ˆì§€ë§‰ ì œì™¸)
        const lineIndex = Math.floor(Math.random() * (NUM_PLAYERS - 1));
        
        horizontalLines.push({
          startIndex: lineIndex,
          endIndex: lineIndex + 1,
          y: y
        });
      }
      
      // ê²°ê³¼ ìˆœì„œ ì„ê¸°
      shuffleResults();
      
      // ì‚¬ë‹¤ë¦¬ ê·¸ë¦¬ê¸°
      clearCanvas();
      drawLadder();
      
      updateDebugInfo("ì‚¬ë‹¤ë¦¬ê°€ ìƒˆë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
    
    // ì‚¬ë‹¤ë¦¬ ê·¸ë¦¬ê¸°
    function drawLadder() {
      // ì„¸ë¡œì„  ê·¸ë¦¬ê¸°
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 3;
      
      for (let i = 0; i < verticalLines.length; i++) {
        ctx.beginPath();
        ctx.moveTo(verticalLines[i], 0);
        ctx.lineTo(verticalLines[i], canvas.height);
        ctx.stroke();
      }
      
      // ê°€ë¡œì„  ê·¸ë¦¬ê¸°
      for (const line of horizontalLines) {
        const x1 = verticalLines[line.startIndex];
        const x2 = verticalLines[line.endIndex];
        
        ctx.beginPath();
        ctx.moveTo(x1, line.y);
        ctx.lineTo(x2, line.y);
        ctx.stroke();
        
        // ë””ë²„ê·¸ ëª¨ë“œì—ì„œ ë°©í–¥ í‘œì‹œ
        if (debugMode) {
          // ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ (ë§¨ ì™¼ìª½ ì„¸ë¡œì„ ì—ì„œ)
          if (line.startIndex === 0) {
            drawArrow(x1 + 15, line.y, 'â†’', '#FFEB3B');
          }
          // ì˜¤ë¥¸ìª½ì—ì„œ ì™¼ìª½ í™”ì‚´í‘œ (ë§¨ ì˜¤ë¥¸ìª½ ì„¸ë¡œì„ ì—ì„œ)
          else if (line.endIndex === NUM_PLAYERS - 1) {
            drawArrow(x2 - 15, line.y, 'â†', '#FFEB3B');
          }
        }
      }
    }
    
    // í™”ì‚´í‘œ ê·¸ë¦¬ê¸° (ë””ë²„ê·¸ìš©)
    function drawArrow(x, y, direction, color) {
      ctx.fillStyle = color;
      ctx.font = '14px Arial';
      ctx.textAlign = 'center';
      ctx.fillText(direction, x, y - 5);
    }
    
    // ê²°ê³¼ ìˆœì„œ ì„ê¸°
    function shuffleResults() {
      // ë¨¼ì € ë‚¨ì€ ìƒí’ˆ í™•ì¸
      const availablePrizes = [];
      
      for (let i = 0; i < prizes.length; i++) {
        // ì¬ê³ ê°€ ìˆìœ¼ë©´ ì¸ë±ìŠ¤ ì¶”ê°€
        if (prizes[i].remaining > 0) {
          availablePrizes.push(i);
        }
      }
      
      // ê½(ì¸ë±ìŠ¤ 4)ì€ ë¬´í•œëŒ€ ìˆ˜ëŸ‰ì´ë¯€ë¡œ ë‚¨ì€ ìë¦¬ë¥¼ ê½ìœ¼ë¡œ ì±„ì›€
      resultOrder = Array(NUM_PLAYERS).fill(4); // ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë‘ ê½ìœ¼ë¡œ ì„¤ì •
      
      // ê°€ëŠ¥í•œ ìƒí’ˆë“¤ì„ ëœë¤í•˜ê²Œ ë°°ì¹˜
      const positions = Array.from({length: NUM_PLAYERS}, (_, i) => i);
      for (let i = positions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [positions[i], positions[j]] = [positions[j], positions[i]];
      }
      
      // ë‚¨ì€ ìƒí’ˆë§Œí¼ ë°°ì¹˜ (ê½ ì œì™¸)
      let availableCount = 0;
      for (let i = 0; i < availablePrizes.length; i++) {
        // ê½ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ë°°ì¹˜ (ê½ì€ ì´ë¯¸ ì±„ì›Œì ¸ ìˆìŒ)
        if (availablePrizes[i] !== 4 && prizes[availablePrizes[i]].remaining > 0 && availableCount < positions.length) {
          resultOrder[positions[availableCount]] = availablePrizes[i];
          availableCount++;
        }
      }
      
      // ê²°ê³¼ í‘œì‹œ ì—…ë°ì´íŠ¸
      for (let i = 0; i < resultOrder.length; i++) {
        const resultElement = document.getElementById(`result${i}`);
        const prize = prizes[resultOrder[i]];
        resultElement.querySelector('.emoji').textContent = prize.emoji;
        resultElement.querySelector('span:not(.emoji)').textContent = prize.name;
      }
      
      // ì¸ë²¤í† ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸
      updateInventoryDisplay();
    }
    
    // ì¸ë²¤í† ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateInventoryDisplay() {
      // ê° ìƒí’ˆë³„ ì¬ê³  í‘œì‹œ ì—…ë°ì´íŠ¸
      document.getElementById('coffee-count').textContent = prizes[0].remaining;
      document.getElementById('placean-count').textContent = prizes[1].remaining;
      document.getElementById('professor-count').textContent = prizes[2].remaining;
      document.getElementById('mentor-count').textContent = prizes[3].remaining;
      
      // ì¬ê³ ê°€ ì—†ëŠ” ìƒí’ˆì€ í‘œì‹œì—ì„œ ì œì™¸
      const inventoryContainer = document.querySelector('.inventory p');
      let inventoryText = 'ë‚¨ì€ ìƒí’ˆ:  ';
      let hasItems = false;
      
      if (prizes[0].remaining > 0) {
        inventoryText += `ì•„ì´ìŠ¤ì»¤í”¼ ì¿ í° <span id="coffee-count">${prizes[0].remaining}</span>/${prizes[0].total}  |  `;
        hasItems = true;
      }
      
      if (prizes[1].remaining > 0) {
        inventoryText += `í”Œë ˆì´ìŠ¤ì•¤ ì¿ í° <span id="placean-count">${prizes[1].remaining}</span>/${prizes[1].total}  |  `;
        hasItems = true;
      }
      
      if (prizes[2].remaining > 0) {
        inventoryText += `êµìˆ˜ì™€ì˜ ì‹ì‚¬ <span id="professor-count">${prizes[2].remaining}</span>/${prizes[2].total}  |  `;
        hasItems = true;
      }
      
      if (prizes[3].remaining > 0) {
        inventoryText += `ë©˜í† ì™€ì˜ ì‹ì‚¬ <span id="mentor-count">${prizes[3].remaining}</span>/${prizes[3].total}`;
        hasItems = true;
      }
      
      // ë§ˆì§€ë§‰ êµ¬ë¶„ì ì œê±°
      if (inventoryText.endsWith('|  ')) {
        inventoryText = inventoryText.slice(0, -3);
      }
      
      // ìƒí’ˆì´ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ ë©”ì‹œì§€ ë³€ê²½
      if (!hasItems) {
        inventoryText = 'ëª¨ë“  ìƒí’ˆì´ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤!';
      }
      
      inventoryContainer.innerHTML = inventoryText;
    }
    
    // ê²½ë¡œ ì°¾ê¸°
    function findPath(playerIndex) {
      if (isAnimating) return;
      
      isAnimating = true;
      selectedPlayer = playerIndex;
      
      // ì„ íƒëœ í”Œë ˆì´ì–´ í•˜ì´ë¼ì´íŠ¸
      players.forEach((p, idx) => {
        if (idx === playerIndex) {
          p.classList.add('selected');
        } else {
          p.classList.remove('selected');
        }
      });
      
      // ê²½ë¡œ ê³„ì‚°
      const path = calculatePath(playerIndex);
      
      // ê²½ë¡œ ì• ë‹ˆë©”ì´ì…˜
      animatePath(path);
    }
    
    // ê²½ë¡œ ê³„ì‚°
    function calculatePath(playerIndex) {
      let path = [];
      let currentIndex = playerIndex;
      
      // ì‹œì‘ì  ì¶”ê°€
      path.push({
        x: verticalLines[currentIndex],
        y: 0,
        type: 'start'
      });
      
      // ì„¸ë¡œì„  ë”°ë¼ ë‚´ë ¤ê°€ê¸°
      let currentY = 0;
      
      // í˜„ì¬ y ìœ„ì¹˜ë¶€í„° ëª¨ë“  ê°€ë¡œì„ ì„ ì •ë ¬
      const sortedLines = [...horizontalLines].sort((a, b) => a.y - b.y);
      
      for (const line of sortedLines) {
        // í˜„ì¬ ì„¸ë¡œì„ ì— ì—°ê²°ëœ ê°€ë¡œì„ ì¸ì§€ í™•ì¸
        if (line.startIndex === currentIndex || line.endIndex === currentIndex) {
          // ì„¸ë¡œì„  ì´ë™ (í˜„ì¬ ìœ„ì¹˜ì—ì„œ ê°€ë¡œì„ ê¹Œì§€)
          path.push({
            x: verticalLines[currentIndex],
            y: line.y,
            type: 'vertical'
          });
          
          // ê°€ë¡œì„  ë”°ë¼ ì´ë™ (ì¤‘ìš”: ë°©í–¥ ê²°ì •)
          let nextIndex;
          
          if (line.startIndex === currentIndex) {
            // í˜„ì¬ ì„¸ë¡œì„ ì´ ê°€ë¡œì„ ì˜ ì™¼ìª½ ë
            nextIndex = line.endIndex;
            
            // ì™¼ìª½â†’ì˜¤ë¥¸ìª½ ì´ë™
            path.push({
              x: verticalLines[nextIndex],
              y: line.y,
              type: 'horizontal',
              direction: 'right'
            });
          } else {
            // í˜„ì¬ ì„¸ë¡œì„ ì´ ê°€ë¡œì„ ì˜ ì˜¤ë¥¸ìª½ ë
            nextIndex = line.startIndex;
            
            // ì˜¤ë¥¸ìª½â†’ì™¼ìª½ ì´ë™
            path.push({
              x: verticalLines[nextIndex],
              y: line.y,
              type: 'horizontal',
              direction: 'left'
            });
          }
          
          currentIndex = nextIndex;
          currentY = line.y;
        }
      }
      
      // ë§ˆì§€ë§‰ ì„¸ë¡œì„  ì´ë™ (ë§¨ ì•„ë˜ê¹Œì§€)
      path.push({
        x: verticalLines[currentIndex],
        y: canvas.height,
        type: 'vertical'
      });
      
      return {
        path: path,
        finalIndex: currentIndex
      };
    }
    
    // ê²½ë¡œ ì• ë‹ˆë©”ì´ì…˜ (ìƒˆë¡œìš´ ë²„ì „ - ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜)
    function animatePath(pathData) {
      const { path, finalIndex } = pathData;
      
      // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ ì‹œê°„
      const startTime = performance.now();
      const totalLength = calculatePathTotalLength(path);
      
      // í˜„ì¬ ê·¸ë ¤ì§„ ê±°ë¦¬ë¥¼ ì¶”ì 
      let drawnLength = 0;
      
      // ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„ í•¨ìˆ˜
      function animate(currentTime) {
        // ì• ë‹ˆë©”ì´ì…˜ ì§„í–‰ë¥  ê³„ì‚° (0~1)
        const elapsedTime = currentTime - startTime;
        const progress = Math.min(elapsedTime / ANIMATION_DURATION, 1);
        
        // ì´ë²ˆ í”„ë ˆì„ì—ì„œ ê·¸ë ¤ì•¼ í•  ì´ ê¸¸ì´
        const targetLength = totalLength * progress;
        
        // ì´ì „ê¹Œì§€ ê·¸ë¦° ê²½ë¡œ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
        clearCanvas();
        drawLadder();
        
        // ê²½ë¡œ ê·¸ë¦¬ê¸°
        let currentDrawnLength = 0;
        
        ctx.strokeStyle = '#FF5722';
        ctx.lineWidth = 4;
        ctx.beginPath();
        
        // ì‹œì‘ì ìœ¼ë¡œ ì´ë™
        ctx.moveTo(path[0].x, path[0].y);
        
        // ê° ì„¸ê·¸ë¨¼íŠ¸ ê·¸ë¦¬ê¸°
        for (let i = 1; i < path.length; i++) {
          const prevPoint = path[i-1];
          const currentPoint = path[i];
          
          // ì„¸ê·¸ë¨¼íŠ¸ ê¸¸ì´ ê³„ì‚°
          const segmentLength = getDistance(prevPoint, currentPoint);
          
          // ì´ì „ê¹Œì§€ ê·¸ë¦° ê¸¸ì´ + í˜„ì¬ ì„¸ê·¸ë¨¼íŠ¸ ê¸¸ì´ê°€ ëª©í‘œ ê¸¸ì´ë³´ë‹¤ ì‘ìœ¼ë©´ ì™„ì „íˆ ê·¸ë¦¼
          if (currentDrawnLength + segmentLength <= targetLength) {
            ctx.lineTo(currentPoint.x, currentPoint.y);
            currentDrawnLength += segmentLength;
          } else {
            // ë¶€ë¶„ì ìœ¼ë¡œ ê·¸ë ¤ì•¼ í•¨
            const remainingLength = targetLength - currentDrawnLength;
            const ratio = remainingLength / segmentLength;
            
            // ë³´ê°„ëœ ì¢Œí‘œ ê³„ì‚°
            const x = prevPoint.x + (currentPoint.x - prevPoint.x) * ratio;
            const y = prevPoint.y + (currentPoint.y - prevPoint.y) * ratio;
            
            ctx.lineTo(x, y);
            currentDrawnLength = targetLength;
            break;
          }
        }
        
        ctx.stroke();
        
        // ì•„ì§ ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚˜ì§€ ì•Šì•˜ìœ¼ë©´ ë‹¤ìŒ í”„ë ˆì„ ìš”ì²­
        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ ê²°ê³¼ í‘œì‹œ
          showResult(finalIndex);
        }
      }
      
      // ì²« í”„ë ˆì„ ì‹œì‘
      requestAnimationFrame(animate);
    }
    
    // ë‘ ì  ì‚¬ì´ì˜ ê±°ë¦¬ ê³„ì‚°
    function getDistance(point1, point2) {
      const dx = point2.x - point1.x;
      const dy = point2.y - point1.y;
      return Math.sqrt(dx * dx + dy * dy);
    }
    
    // ê²½ë¡œì˜ ì´ ê¸¸ì´ ê³„ì‚°
    function calculatePathTotalLength(path) {
      let totalLength = 0;
      
      for (let i = 1; i < path.length; i++) {
        totalLength += getDistance(path[i-1], path[i]);
      }
      
      return totalLength;
    }
    
    // ê²°ê³¼ í‘œì‹œ
    function showResult(resultIndex) {
      // ì„ íƒëœ í”Œë ˆì´ì–´ í…ìŠ¤íŠ¸ ì„¤ì •
      const playerText = document.querySelector(`.player[data-index="${selectedPlayer}"]`).querySelector('span:not(.emoji)').textContent;
      selectedPlayerText.textContent = playerText;
      
      // ê²°ê³¼ ì´ë¯¸ì§€ì™€ ì´ë¦„ ì„¤ì •
      const prizeIndex = resultOrder[resultIndex];
      const prize = prizes[prizeIndex];
      resultEmoji.textContent = prize.emoji;
      resultName.textContent = prize.name;
      
      // ë””ë²„ê·¸ ì •ë³´ ì—…ë°ì´íŠ¸
      updateDebugInfo(`í”Œë ˆì´ì–´ ${selectedPlayer} (${playerText})ëŠ” ê²°ê³¼ ${resultIndex} (${prize.name})ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤.`);
      
      // ë‹¹ì²¨ëœ ìƒí’ˆì´ ê½ì´ ì•„ë‹ˆë©´ ìˆ˜ëŸ‰ ê°ì†Œ
      if (prizeIndex !== 4 && prize.remaining > 0) {
        prize.remaining--;
        updateInventoryDisplay();
        updateInventoryStatus();
      }
      
      // ê²°ê³¼ íŒì—… í‘œì‹œ
      setTimeout(() => {
        resultPopup.style.display = 'flex';
        
        // ì• ë‹ˆë©”ì´ì…˜ ìƒíƒœ ë¦¬ì…‹
        setTimeout(() => {
          isAnimating = false;
        }, 1000);
      }, 500);
    }
    
    // ë””ë²„ê·¸ ì •ë³´ ì—…ë°ì´íŠ¸
    function updateDebugInfo(message) {
      if (debugMode) {
        const timestamp = new Date().toLocaleTimeString();
        debugInfo.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        debugInfo.scrollTop = debugInfo.scrollHeight;
      }
    }
  </script>
</body>
</html>